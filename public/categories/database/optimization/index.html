<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>資料庫效能優化全指南 | Chris&#39;s Website</title>
<meta name="keywords" content="MySQL, PostgreSQL, 資料庫, 效能優化, 索引">
<meta name="description" content="從查詢優化、索引設計到系統配置，全面提升資料庫效能的實用技巧">
<meta name="author" content="chirs">
<link rel="canonical" href="https://leetcode666.com/categories/database/optimization/">
<meta name="google-site-verification" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4c6627b3ba5233a911ed977febcd4f45dbcab6817f0fdada75505e0b0c938a60.css" integrity="sha256-TGYns7pSM6kR7Zd/681PRdvKtoF/D9radVBeCwyTimA=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://leetcode666.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://leetcode666.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://leetcode666.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://leetcode666.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://leetcode666.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://leetcode666.com/categories/database/optimization/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-QNR8ZBX7XN"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-QNR8ZBX7XN');
        }
      </script><meta property="og:url" content="https://leetcode666.com/categories/database/optimization/">
  <meta property="og:site_name" content="Chris&#39;s Website">
  <meta property="og:title" content="資料庫效能優化全指南">
  <meta property="og:description" content="從查詢優化、索引設計到系統配置，全面提升資料庫效能的實用技巧">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="categories">
    <meta property="article:published_time" content="2023-08-18T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-08-18T00:00:00+00:00">
    <meta property="article:tag" content="MySQL">
    <meta property="article:tag" content="PostgreSQL">
    <meta property="article:tag" content="資料庫">
    <meta property="article:tag" content="效能優化">
    <meta property="article:tag" content="索引">
      <meta property="og:image" content="https://leetcode666.com/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://leetcode666.com/images/papermod-cover.png">
<meta name="twitter:title" content="資料庫效能優化全指南">
<meta name="twitter:description" content="從查詢優化、索引設計到系統配置，全面提升資料庫效能的實用技巧">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Categories",
      "item": "https://leetcode666.com/categories/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "database",
      "item": "https://leetcode666.com/categories/database/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "資料庫效能優化全指南",
      "item": "https://leetcode666.com/categories/database/optimization/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "資料庫效能優化全指南",
  "name": "資料庫效能優化全指南",
  "description": "從查詢優化、索引設計到系統配置，全面提升資料庫效能的實用技巧",
  "keywords": [
    "MySQL", "PostgreSQL", "資料庫", "效能優化", "索引"
  ],
  "articleBody": "資料庫效能優化全指南 在現代應用程式開發中，資料庫效能往往是系統整體性能的關鍵瓶頸。本文將從多個層面探討如何優化資料庫效能，涵蓋從基本的查詢優化到進階的系統配置調整。\n查詢優化基礎 1. 使用 EXPLAIN 分析查詢 在優化任何查詢前，首先應該了解它的執行計劃：\nEXPLAIN SELECT * FROM users WHERE email = 'example@domain.com'; EXPLAIN 提供的關鍵指標：\n使用的索引 掃描的行數 使用的連接類型 臨時表和檔案排序的使用情況 2. 避免 SELECT * 只查詢需要的欄位，減少網路傳輸和記憶體使用：\n-- 不推薦 SELECT * FROM products WHERE category_id = 5; -- 推薦 SELECT id, name, price FROM products WHERE category_id = 5; 3. 使用適當的 WHERE 條件 確保 WHERE 條件能夠使用到索引：\n-- 可能使用不到索引 SELECT * FROM users WHERE YEAR(created_at) = 2023; -- 重寫為使用索引的形式 SELECT * FROM users WHERE created_at BETWEEN '2023-01-01' AND '2023-12-31'; 4. 限制結果集大小 使用 LIMIT 控制返回的記錄數：\nSELECT * FROM logs ORDER BY created_at DESC LIMIT 100; 索引設計與優化 1. 基礎索引原則 為經常用於 WHERE、JOIN 和 ORDER BY 的欄位建立索引 高選擇性的欄位（唯一值較多）更適合建立索引 避免在頻繁更新的欄位上建立過多索引 2. 複合索引設計 複合索引的欄位順序至關重要：\n-- 創建複合索引 CREATE INDEX idx_users_email_status ON users(email, status); -- 能使用索引 SELECT * FROM users WHERE email = 'test@example.com' AND status = 'active'; SELECT * FROM users WHERE email = 'test@example.com'; -- 可能無法使用索引 SELECT * FROM users WHERE status = 'active'; 3. 覆蓋索引 設計索引使查詢只需要訪問索引而不需要訪問表：\n-- 創建包含所需欄位的索引 CREATE INDEX idx_products_category_name_price ON products(category_id, name, price); -- 查詢只需訪問索引 SELECT name, price FROM products WHERE category_id = 5; 4. 定期分析和重建索引 隨著數據變化，索引可能變得碎片化：\n-- MySQL/MariaDB ANALYZE TABLE users; OPTIMIZE TABLE users; -- PostgreSQL VACUUM ANALYZE users; REINDEX TABLE users; 資料庫架構優化 1. 表正規化與反正規化 正規化：減少資料重複，提高資料一致性 反正規化：適度增加資料冗餘，減少連接操作，提高讀取效能 判斷使用哪種策略時，考慮：\n讀取/寫入比率 查詢模式 資料一致性需求 2. 分區表 將大表分割成較小的、更易管理的部分：\n-- MySQL 例子，按年份分區 CREATE TABLE sales ( id INT NOT NULL, sale_date DATE NOT NULL, amount DECIMAL(10,2) ) PARTITION BY RANGE (YEAR(sale_date)) ( PARTITION p2021 VALUES LESS THAN (2022), PARTITION p2022 VALUES LESS THAN (2023), PARTITION p2023 VALUES LESS THAN (2024) ); 3. 讀寫分離 將讀操作導向複本/從伺服器 將寫操作導向主伺服器 通過中間層或ORM設定路由規則 4. 分片（Sharding） 對於超大規模應用，水平分片可以將資料分布到多個資料庫：\n按鍵範圍分片：例如用戶ID 1-1000000在Shard1，1000001-2000000在Shard2 按雜湊分片：計算記錄的雜湊值來決定分片位置 按地理位置分片：不同地區的資料存放在就近的資料庫伺服器 資料庫系統配置優化 1. 記憶體配置 調整緩衝池和查詢快取的大小：\n# MySQL例子 innodb_buffer_pool_size = 8G # 通常設為系統記憶體的50-70% innodb_log_file_size = 512M # 較大的日誌文件減少檢查點次數 2. 磁碟I/O優化 使用SSD而非傳統硬碟 RAID配置（RAID10通常最適合資料庫） 分離資料文件和日誌文件到不同磁碟 3. 連線池設定 避免頻繁建立和銷毀資料庫連線：\n# PostgreSQL例子 max_connections = 100 shared_buffers = 2GB work_mem = 32MB 4. 查詢快取 對於讀多寫少的應用，配置適當的查詢快取：\n# MySQL例子 (注意：MySQL 8.0+已棄用) query_cache_type = 1 query_cache_size = 256M 監控與持續優化 1. 關鍵指標監控 查詢響應時間 查詢吞吐量 緩存命中率 慢查詢數量 鎖等待時間 2. 慢查詢日誌分析 啟用並定期分析慢查詢日誌：\n# MySQL配置 slow_query_log = 1 slow_query_log_file = /var/log/mysql/slow.log long_query_time = 1 # 超過1秒的查詢記入日誌 常用分析工具：\npt-query-digest (Percona Toolkit) pgBadger (PostgreSQL) 3. 自動化效能測試 建立基準測試套件，在重大變更前評估效能影響：\nsysbench pgbench (PostgreSQL) JMeter 特定資料庫優化技巧 MySQL/MariaDB -- 優化表結構 ALTER TABLE orders ENGINE=InnoDB; -- 使用InnoDB引擎 -- 查看表統計資訊 SHOW TABLE STATUS LIKE 'users'; -- 調整自動增長步長，減少在多伺服器環境中的衝突 SET @@auto_increment_increment=10; PostgreSQL -- 自動分析統計資訊 ALTER TABLE users SET (autovacuum_enabled = on); -- 使用部分索引，僅為符合條件的列建立索引 CREATE INDEX idx_active_users ON users(email) WHERE status = 'active'; -- 使用BRIN索引代替B-tree索引，適用於有序大表 CREATE INDEX idx_logs_timestamp ON logs USING BRIN (created_at); 案例分析 案例1：電子商務訂單查詢優化 問題：訂單歷史查詢緩慢，特別是對有大量訂單的客戶。\n解決方案：\n為customer_id和order_date創建複合索引 分區表按訂單日期範圍 為常用查詢條件增加覆蓋索引 考慮對歷史訂單進行歸檔 優化後：查詢時間從2秒降至50毫秒。\n案例2：社交媒體貼文列表 問題：用戶動態流查詢涉及多表連接，效能差。\n解決方案：\n查詢反正規化，預先計算並存儲關鍵統計 實現讀寫分離，讀取操作到從伺服器 使用快取層（Redis）存儲熱門貼文 實現無限滾動而非分頁，限制每次載入數量 優化後：頁面載入時間減少75%，伺服器負載降低60%。\n總結 資料庫優化是一個持續的過程，需要結合多種策略：\n查詢層面：編寫高效SQL，使用EXPLAIN分析執行計劃 結構層面：設計合適的索引和表結構 架構層面：實現分區、分片和讀寫分離 系統層面：調整資料庫伺服器配置 最佳實踐是從應用程式設計階段就考慮資料庫效能，並建立持續監控和優化的機制。針對特定應用場景，進行針對性優化往往比通用策略更有效。\n",
  "wordCount" : "417",
  "inLanguage": "en",
  "image": "https://leetcode666.com/images/papermod-cover.png","datePublished": "2023-08-18T00:00:00Z",
  "dateModified": "2023-08-18T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "chirs"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://leetcode666.com/categories/database/optimization/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Chris's Website",
    "logo": {
      "@type": "ImageObject",
      "url": "https://leetcode666.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top"><header class="custom-header">
    <div class="nav-container">
        <div class="logo-area">
                    
                <a href="https://leetcode666.com/">
                    <img src="https://leetcode666.com/images/logo_hu_36d5b57208cd85e6.png" alt="Chris&#39;s Website" class="site-logo">
                </a><a href="https://leetcode666.com/" class="site-title">Chris的技術筆記</a>
        </div>

        <nav class="main-nav">
            <ul class="nav-items">
                
                <li class="nav-item dropdown">
                    <a href="#" class="dropdown-toggle">Leetcode刷題專區 <span class="caret">▼</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="https://leetcode666.com/categories/leetcode/">全部</a></li>
                        <li><a href="https://leetcode666.com/categories/leetcode/hashtable/">HashTable(雜湊表)</a></li>
                        <li><a href="https://leetcode666.com/categories/leetcode/linkedlist/">LinkedList(鏈表)</a></li>
                        <li><a href="https://leetcode666.com/categories/leetcode/stack/">Stack(堆疊)</a></li>
                        <li><a href="https://leetcode666.com/categories/leetcode/queue/">Queue(佇列)</a></li>
                        <li><a href="https://leetcode666.com/categories/leetcode/tree/">Tree(樹)</a></li>
                        <li><a href="https://leetcode666.com/categories/leetcode/graph/">Graph(圖)</a></li>
                        <li><a href="https://leetcode666.com/categories/leetcode/dynamic-programming/">Dynamic Programming(動態規劃)</a></li>
                    </ul>
                </li>


                
                <li class="nav-item dropdown">
                    <a href="#" class="dropdown-toggle">後端技術專欄 <span class="caret">▼</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="https://leetcode666.com/categories/backend/">Django和後端技術</a></li>
                        <li><a href="https://leetcode666.com/categories/api-design/">API 設計</a></li>
                        <li><a href="https://leetcode666.com/ategories/database/">資料庫優化</a></li>
                    </ul>
                </li>
                
                
                <li class="nav-item dropdown">
                    <a href="#" class="dropdown-toggle">線上課程 <span class="caret">▼</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="https://leetcode666.com/courses/django/">Django 網站開發</a></li>
                        <li><a href="https://leetcode666.com/courses/leetcode/">資料結構與演算法</a></li>
                    </ul>
                </li>


                
                
                <li class="nav-item">
                    <a href="https://leetcode666.com/about/">關於我</a>
                </li>
            </ul>
        </nav>
        
        <div class="nav-right">
            
            <a href="/search/" title="搜尋 (Alt + /)" class="search-button" accesskey="/">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </a>
            
            
            <a href="/subscribe/" class="nav-subscribe">電子報訂閱</a>
        </div>
    </div>
</header> 
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://leetcode666.com/">Home</a>&nbsp;»&nbsp;<a href="https://leetcode666.com/categories/">Categories</a>&nbsp;»&nbsp;<a href="https://leetcode666.com/categories/database/">database</a></div>
    <h1 class="post-title entry-hint-parent">
      資料庫效能優化全指南
    </h1>
    <div class="post-description">
      從查詢優化、索引設計到系統配置，全面提升資料庫效能的實用技巧
    </div>
    <div class="post-meta"><span title='2023-08-18 00:00:00 +0000 UTC'>August 18, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;chirs

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%b3%87%e6%96%99%e5%ba%ab%e6%95%88%e8%83%bd%e5%84%aa%e5%8c%96%e5%85%a8%e6%8c%87%e5%8d%97" aria-label="資料庫效能優化全指南">資料庫效能優化全指南</a><ul>
                        
                <li>
                    <a href="#%e6%9f%a5%e8%a9%a2%e5%84%aa%e5%8c%96%e5%9f%ba%e7%a4%8e" aria-label="查詢優化基礎">查詢優化基礎</a><ul>
                        
                <li>
                    <a href="#1-%e4%bd%bf%e7%94%a8-explain-%e5%88%86%e6%9e%90%e6%9f%a5%e8%a9%a2" aria-label="1. 使用 EXPLAIN 分析查詢">1. 使用 EXPLAIN 分析查詢</a></li>
                <li>
                    <a href="#2-%e9%81%bf%e5%85%8d-select-" aria-label="2. 避免 SELECT *">2. 避免 SELECT *</a></li>
                <li>
                    <a href="#3-%e4%bd%bf%e7%94%a8%e9%81%a9%e7%95%b6%e7%9a%84-where-%e6%a2%9d%e4%bb%b6" aria-label="3. 使用適當的 WHERE 條件">3. 使用適當的 WHERE 條件</a></li>
                <li>
                    <a href="#4-%e9%99%90%e5%88%b6%e7%b5%90%e6%9e%9c%e9%9b%86%e5%a4%a7%e5%b0%8f" aria-label="4. 限制結果集大小">4. 限制結果集大小</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e8%a8%ad%e8%a8%88%e8%88%87%e5%84%aa%e5%8c%96" aria-label="索引設計與優化">索引設計與優化</a><ul>
                        
                <li>
                    <a href="#1-%e5%9f%ba%e7%a4%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e5%89%87" aria-label="1. 基礎索引原則">1. 基礎索引原則</a></li>
                <li>
                    <a href="#2-%e8%a4%87%e5%90%88%e7%b4%a2%e5%bc%95%e8%a8%ad%e8%a8%88" aria-label="2. 複合索引設計">2. 複合索引設計</a></li>
                <li>
                    <a href="#3-%e8%a6%86%e8%93%8b%e7%b4%a2%e5%bc%95" aria-label="3. 覆蓋索引">3. 覆蓋索引</a></li>
                <li>
                    <a href="#4-%e5%ae%9a%e6%9c%9f%e5%88%86%e6%9e%90%e5%92%8c%e9%87%8d%e5%bb%ba%e7%b4%a2%e5%bc%95" aria-label="4. 定期分析和重建索引">4. 定期分析和重建索引</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%b3%87%e6%96%99%e5%ba%ab%e6%9e%b6%e6%a7%8b%e5%84%aa%e5%8c%96" aria-label="資料庫架構優化">資料庫架構優化</a><ul>
                        
                <li>
                    <a href="#1-%e8%a1%a8%e6%ad%a3%e8%a6%8f%e5%8c%96%e8%88%87%e5%8f%8d%e6%ad%a3%e8%a6%8f%e5%8c%96" aria-label="1. 表正規化與反正規化">1. 表正規化與反正規化</a></li>
                <li>
                    <a href="#2-%e5%88%86%e5%8d%80%e8%a1%a8" aria-label="2. 分區表">2. 分區表</a></li>
                <li>
                    <a href="#3-%e8%ae%80%e5%af%ab%e5%88%86%e9%9b%a2" aria-label="3. 讀寫分離">3. 讀寫分離</a></li>
                <li>
                    <a href="#4-%e5%88%86%e7%89%87sharding" aria-label="4. 分片（Sharding）">4. 分片（Sharding）</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%b3%87%e6%96%99%e5%ba%ab%e7%b3%bb%e7%b5%b1%e9%85%8d%e7%bd%ae%e5%84%aa%e5%8c%96" aria-label="資料庫系統配置優化">資料庫系統配置優化</a><ul>
                        
                <li>
                    <a href="#1-%e8%a8%98%e6%86%b6%e9%ab%94%e9%85%8d%e7%bd%ae" aria-label="1. 記憶體配置">1. 記憶體配置</a></li>
                <li>
                    <a href="#2-%e7%a3%81%e7%a2%9fio%e5%84%aa%e5%8c%96" aria-label="2. 磁碟I/O優化">2. 磁碟I/O優化</a></li>
                <li>
                    <a href="#3-%e9%80%a3%e7%b7%9a%e6%b1%a0%e8%a8%ad%e5%ae%9a" aria-label="3. 連線池設定">3. 連線池設定</a></li>
                <li>
                    <a href="#4-%e6%9f%a5%e8%a9%a2%e5%bf%ab%e5%8f%96" aria-label="4. 查詢快取">4. 查詢快取</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%9b%a3%e6%8e%a7%e8%88%87%e6%8c%81%e7%ba%8c%e5%84%aa%e5%8c%96" aria-label="監控與持續優化">監控與持續優化</a><ul>
                        
                <li>
                    <a href="#1-%e9%97%9c%e9%8d%b5%e6%8c%87%e6%a8%99%e7%9b%a3%e6%8e%a7" aria-label="1. 關鍵指標監控">1. 關鍵指標監控</a></li>
                <li>
                    <a href="#2-%e6%85%a2%e6%9f%a5%e8%a9%a2%e6%97%a5%e8%aa%8c%e5%88%86%e6%9e%90" aria-label="2. 慢查詢日誌分析">2. 慢查詢日誌分析</a></li>
                <li>
                    <a href="#3-%e8%87%aa%e5%8b%95%e5%8c%96%e6%95%88%e8%83%bd%e6%b8%ac%e8%a9%a6" aria-label="3. 自動化效能測試">3. 自動化效能測試</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%89%b9%e5%ae%9a%e8%b3%87%e6%96%99%e5%ba%ab%e5%84%aa%e5%8c%96%e6%8a%80%e5%b7%a7" aria-label="特定資料庫優化技巧">特定資料庫優化技巧</a><ul>
                        
                <li>
                    <a href="#mysqlmariadb" aria-label="MySQL/MariaDB">MySQL/MariaDB</a></li>
                <li>
                    <a href="#postgresql" aria-label="PostgreSQL">PostgreSQL</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%a1%88%e4%be%8b%e5%88%86%e6%9e%90" aria-label="案例分析">案例分析</a><ul>
                        
                <li>
                    <a href="#%e6%a1%88%e4%be%8b1%e9%9b%bb%e5%ad%90%e5%95%86%e5%8b%99%e8%a8%82%e5%96%ae%e6%9f%a5%e8%a9%a2%e5%84%aa%e5%8c%96" aria-label="案例1：電子商務訂單查詢優化">案例1：電子商務訂單查詢優化</a></li>
                <li>
                    <a href="#%e6%a1%88%e4%be%8b2%e7%a4%be%e4%ba%a4%e5%aa%92%e9%ab%94%e8%b2%bc%e6%96%87%e5%88%97%e8%a1%a8" aria-label="案例2：社交媒體貼文列表">案例2：社交媒體貼文列表</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%b8%bd%e7%b5%90" aria-label="總結">總結</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="資料庫效能優化全指南">資料庫效能優化全指南<a hidden class="anchor" aria-hidden="true" href="#資料庫效能優化全指南">#</a></h1>
<p>在現代應用程式開發中，資料庫效能往往是系統整體性能的關鍵瓶頸。本文將從多個層面探討如何優化資料庫效能，涵蓋從基本的查詢優化到進階的系統配置調整。</p>
<h2 id="查詢優化基礎">查詢優化基礎<a hidden class="anchor" aria-hidden="true" href="#查詢優化基礎">#</a></h2>
<h3 id="1-使用-explain-分析查詢">1. 使用 EXPLAIN 分析查詢<a hidden class="anchor" aria-hidden="true" href="#1-使用-explain-分析查詢">#</a></h3>
<p>在優化任何查詢前，首先應該了解它的執行計劃：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;example@domain.com&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>EXPLAIN 提供的關鍵指標：</p>
<ul>
<li>使用的索引</li>
<li>掃描的行數</li>
<li>使用的連接類型</li>
<li>臨時表和檔案排序的使用情況</li>
</ul>
<h3 id="2-避免-select-">2. 避免 SELECT *<a hidden class="anchor" aria-hidden="true" href="#2-避免-select-">#</a></h3>
<p>只查詢需要的欄位，減少網路傳輸和記憶體使用：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 不推薦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">category_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 推薦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">category_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="3-使用適當的-where-條件">3. 使用適當的 WHERE 條件<a hidden class="anchor" aria-hidden="true" href="#3-使用適當的-where-條件">#</a></h3>
<p>確保 WHERE 條件能夠使用到索引：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 可能使用不到索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2023</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 重寫為使用索引的形式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2023-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2023-12-31&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="4-限制結果集大小">4. 限制結果集大小<a hidden class="anchor" aria-hidden="true" href="#4-限制結果集大小">#</a></h3>
<p>使用 LIMIT 控制返回的記錄數：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h2 id="索引設計與優化">索引設計與優化<a hidden class="anchor" aria-hidden="true" href="#索引設計與優化">#</a></h2>
<h3 id="1-基礎索引原則">1. 基礎索引原則<a hidden class="anchor" aria-hidden="true" href="#1-基礎索引原則">#</a></h3>
<ul>
<li>為經常用於 WHERE、JOIN 和 ORDER BY 的欄位建立索引</li>
<li>高選擇性的欄位（唯一值較多）更適合建立索引</li>
<li>避免在頻繁更新的欄位上建立過多索引</li>
</ul>
<h3 id="2-複合索引設計">2. 複合索引設計<a hidden class="anchor" aria-hidden="true" href="#2-複合索引設計">#</a></h3>
<p>複合索引的欄位順序至關重要：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 創建複合索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_email_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 能使用索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;test@example.com&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;test@example.com&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 可能無法使用索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="3-覆蓋索引">3. 覆蓋索引<a hidden class="anchor" aria-hidden="true" href="#3-覆蓋索引">#</a></h3>
<p>設計索引使查詢只需要訪問索引而不需要訪問表：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 創建包含所需欄位的索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_products_category_name_price</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 查詢只需訪問索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">category_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="4-定期分析和重建索引">4. 定期分析和重建索引<a hidden class="anchor" aria-hidden="true" href="#4-定期分析和重建索引">#</a></h3>
<p>隨著數據變化，索引可能變得碎片化：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- MySQL/MariaDB
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ANALYZE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">OPTIMIZE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- PostgreSQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">VACUUM</span><span class="w"> </span><span class="k">ANALYZE</span><span class="w"> </span><span class="n">users</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">REINDEX</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h2 id="資料庫架構優化">資料庫架構優化<a hidden class="anchor" aria-hidden="true" href="#資料庫架構優化">#</a></h2>
<h3 id="1-表正規化與反正規化">1. 表正規化與反正規化<a hidden class="anchor" aria-hidden="true" href="#1-表正規化與反正規化">#</a></h3>
<ul>
<li><strong>正規化</strong>：減少資料重複，提高資料一致性</li>
<li><strong>反正規化</strong>：適度增加資料冗餘，減少連接操作，提高讀取效能</li>
</ul>
<p>判斷使用哪種策略時，考慮：</p>
<ul>
<li>讀取/寫入比率</li>
<li>查詢模式</li>
<li>資料一致性需求</li>
</ul>
<h3 id="2-分區表">2. 分區表<a hidden class="anchor" aria-hidden="true" href="#2-分區表">#</a></h3>
<p>將大表分割成較小的、更易管理的部分：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- MySQL 例子，按年份分區
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sales</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sale_date</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">amount</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">RANGE</span><span class="w"> </span><span class="p">(</span><span class="k">YEAR</span><span class="p">(</span><span class="n">sale_date</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">p2021</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">LESS</span><span class="w"> </span><span class="k">THAN</span><span class="w"> </span><span class="p">(</span><span class="mi">2022</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">p2022</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">LESS</span><span class="w"> </span><span class="k">THAN</span><span class="w"> </span><span class="p">(</span><span class="mi">2023</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">p2023</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="k">LESS</span><span class="w"> </span><span class="k">THAN</span><span class="w"> </span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h3 id="3-讀寫分離">3. 讀寫分離<a hidden class="anchor" aria-hidden="true" href="#3-讀寫分離">#</a></h3>
<ul>
<li>將讀操作導向複本/從伺服器</li>
<li>將寫操作導向主伺服器</li>
<li>通過中間層或ORM設定路由規則</li>
</ul>
<h3 id="4-分片sharding">4. 分片（Sharding）<a hidden class="anchor" aria-hidden="true" href="#4-分片sharding">#</a></h3>
<p>對於超大規模應用，水平分片可以將資料分布到多個資料庫：</p>
<ul>
<li><strong>按鍵範圍分片</strong>：例如用戶ID 1-1000000在Shard1，1000001-2000000在Shard2</li>
<li><strong>按雜湊分片</strong>：計算記錄的雜湊值來決定分片位置</li>
<li><strong>按地理位置分片</strong>：不同地區的資料存放在就近的資料庫伺服器</li>
</ul>
<h2 id="資料庫系統配置優化">資料庫系統配置優化<a hidden class="anchor" aria-hidden="true" href="#資料庫系統配置優化">#</a></h2>
<h3 id="1-記憶體配置">1. 記憶體配置<a hidden class="anchor" aria-hidden="true" href="#1-記憶體配置">#</a></h3>
<p>調整緩衝池和查詢快取的大小：</p>
<pre tabindex="0"><code># MySQL例子
innodb_buffer_pool_size = 8G     # 通常設為系統記憶體的50-70%
innodb_log_file_size = 512M      # 較大的日誌文件減少檢查點次數
</code></pre><h3 id="2-磁碟io優化">2. 磁碟I/O優化<a hidden class="anchor" aria-hidden="true" href="#2-磁碟io優化">#</a></h3>
<ul>
<li>使用SSD而非傳統硬碟</li>
<li>RAID配置（RAID10通常最適合資料庫）</li>
<li>分離資料文件和日誌文件到不同磁碟</li>
</ul>
<h3 id="3-連線池設定">3. 連線池設定<a hidden class="anchor" aria-hidden="true" href="#3-連線池設定">#</a></h3>
<p>避免頻繁建立和銷毀資料庫連線：</p>
<pre tabindex="0"><code># PostgreSQL例子
max_connections = 100
shared_buffers = 2GB
work_mem = 32MB
</code></pre><h3 id="4-查詢快取">4. 查詢快取<a hidden class="anchor" aria-hidden="true" href="#4-查詢快取">#</a></h3>
<p>對於讀多寫少的應用，配置適當的查詢快取：</p>
<pre tabindex="0"><code># MySQL例子 (注意：MySQL 8.0+已棄用)
query_cache_type = 1
query_cache_size = 256M
</code></pre><h2 id="監控與持續優化">監控與持續優化<a hidden class="anchor" aria-hidden="true" href="#監控與持續優化">#</a></h2>
<h3 id="1-關鍵指標監控">1. 關鍵指標監控<a hidden class="anchor" aria-hidden="true" href="#1-關鍵指標監控">#</a></h3>
<ul>
<li>查詢響應時間</li>
<li>查詢吞吐量</li>
<li>緩存命中率</li>
<li>慢查詢數量</li>
<li>鎖等待時間</li>
</ul>
<h3 id="2-慢查詢日誌分析">2. 慢查詢日誌分析<a hidden class="anchor" aria-hidden="true" href="#2-慢查詢日誌分析">#</a></h3>
<p>啟用並定期分析慢查詢日誌：</p>
<pre tabindex="0"><code># MySQL配置
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 1  # 超過1秒的查詢記入日誌
</code></pre><p>常用分析工具：</p>
<ul>
<li>pt-query-digest (Percona Toolkit)</li>
<li>pgBadger (PostgreSQL)</li>
</ul>
<h3 id="3-自動化效能測試">3. 自動化效能測試<a hidden class="anchor" aria-hidden="true" href="#3-自動化效能測試">#</a></h3>
<p>建立基準測試套件，在重大變更前評估效能影響：</p>
<ul>
<li>sysbench</li>
<li>pgbench (PostgreSQL)</li>
<li>JMeter</li>
</ul>
<h2 id="特定資料庫優化技巧">特定資料庫優化技巧<a hidden class="anchor" aria-hidden="true" href="#特定資料庫優化技巧">#</a></h2>
<h3 id="mysqlmariadb">MySQL/MariaDB<a hidden class="anchor" aria-hidden="true" href="#mysqlmariadb">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 優化表結構
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span><span class="w">  </span><span class="c1">-- 使用InnoDB引擎
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 查看表統計資訊
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SHOW</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">STATUS</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;users&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 調整自動增長步長，減少在多伺服器環境中的衝突
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="o">@@</span><span class="n">auto_increment_increment</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h3 id="postgresql">PostgreSQL<a hidden class="anchor" aria-hidden="true" href="#postgresql">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 自動分析統計資訊
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="p">(</span><span class="n">autovacuum_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">on</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 使用部分索引，僅為符合條件的列建立索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_active_users</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 使用BRIN索引代替B-tree索引，適用於有序大表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_logs_timestamp</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BRIN</span><span class="w"> </span><span class="p">(</span><span class="n">created_at</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h2 id="案例分析">案例分析<a hidden class="anchor" aria-hidden="true" href="#案例分析">#</a></h2>
<h3 id="案例1電子商務訂單查詢優化">案例1：電子商務訂單查詢優化<a hidden class="anchor" aria-hidden="true" href="#案例1電子商務訂單查詢優化">#</a></h3>
<p><strong>問題</strong>：訂單歷史查詢緩慢，特別是對有大量訂單的客戶。</p>
<p><strong>解決方案</strong>：</p>
<ol>
<li>為customer_id和order_date創建複合索引</li>
<li>分區表按訂單日期範圍</li>
<li>為常用查詢條件增加覆蓋索引</li>
<li>考慮對歷史訂單進行歸檔</li>
</ol>
<p><strong>優化後</strong>：查詢時間從2秒降至50毫秒。</p>
<h3 id="案例2社交媒體貼文列表">案例2：社交媒體貼文列表<a hidden class="anchor" aria-hidden="true" href="#案例2社交媒體貼文列表">#</a></h3>
<p><strong>問題</strong>：用戶動態流查詢涉及多表連接，效能差。</p>
<p><strong>解決方案</strong>：</p>
<ol>
<li>查詢反正規化，預先計算並存儲關鍵統計</li>
<li>實現讀寫分離，讀取操作到從伺服器</li>
<li>使用快取層（Redis）存儲熱門貼文</li>
<li>實現無限滾動而非分頁，限制每次載入數量</li>
</ol>
<p><strong>優化後</strong>：頁面載入時間減少75%，伺服器負載降低60%。</p>
<h2 id="總結">總結<a hidden class="anchor" aria-hidden="true" href="#總結">#</a></h2>
<p>資料庫優化是一個持續的過程，需要結合多種策略：</p>
<ul>
<li>查詢層面：編寫高效SQL，使用EXPLAIN分析執行計劃</li>
<li>結構層面：設計合適的索引和表結構</li>
<li>架構層面：實現分區、分片和讀寫分離</li>
<li>系統層面：調整資料庫伺服器配置</li>
</ul>
<p>最佳實踐是從應用程式設計階段就考慮資料庫效能，並建立持續監控和優化的機制。針對特定應用場景，進行針對性優化往往比通用策略更有效。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://leetcode666.com/tags/mysql/">MySQL</a></li>
      <li><a href="https://leetcode666.com/tags/postgresql/">PostgreSQL</a></li>
      <li><a href="https://leetcode666.com/tags/%E8%B3%87%E6%96%99%E5%BA%AB/">資料庫</a></li>
      <li><a href="https://leetcode666.com/tags/%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96/">效能優化</a></li>
      <li><a href="https://leetcode666.com/tags/%E7%B4%A2%E5%BC%95/">索引</a></li>
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© 2020-2025 程式思維 | All Rights Reserved.</span>
        感謝訪問我的技術網站，希望能幫助你搞定leetcode。
    <div class="footer-social-links">
            <a href="https://github.com/adityatelange/hugo-PaperMod" target="_blank" rel="noopener noreferrer" title="Github">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
            </a>
            <a href="https://discord.gg/ahpmTvhVmp" target="_blank" rel="noopener noreferrer" title="Discord">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36" fill="currentColor" stroke="none" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z" />
</svg>
            </a>
    </div>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    function isMobile() {
        return window.innerWidth <= 960; 
    }
    
    
    function initDropdowns() {
        if (isMobile()) {
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    const parent = this.parentElement;
                    
                    
                    document.querySelectorAll('.nav-item.dropdown.active').forEach(item => {
                        if (item !== parent) {
                            item.classList.remove('active');
                        }
                    });
                    
                    
                    parent.classList.toggle('active');
                });
            });
        }
    }
    
    
    initDropdowns();
    
    
    window.addEventListener('resize', function() {
        initDropdowns();
    });
});
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script> 
</body>

</html>
